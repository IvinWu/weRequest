/*!
 * weRequest 1.0.0
 * https://github.com/IvinWu/weRequest
 */
module.exports=function(t){var n={};function c(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=t,c.c=n,c.d=function(t,n,i){c.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},c.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,n){if(1&n&&(t=c(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(c.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var e in t)c.d(i,e,function(n){return t[n]}.bind(null,e));return i},c.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return c.d(n,"a",n),n},c.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},c.p="",c(c.s=0)}([function(t,n,c){const i=c(1),e=c(2);var u="session",f=function(){return!1},o={},p=function(){return!0},d="",r=function(t){return t},m="操作失败",l=function(t){return t},y=3,h=null,a=!1,w=!1,g=!1,x=null,S="sessionExpireKey",v=1/0,T="",_=!1,k=!1,E=!1;function O(t,n){E?e.wait("checkSessionFinished",function(){O(t,n)}):!_&&T?(E=!0,n.count++,n._checkSessionStartTime=(new Date).getTime(),console.log("wx.checkSession"),wx.checkSession({success:function(){_=!0},fail:function(){T=""},complete:function(){E=!1,n.count--,n._checkSessionEndTime=(new Date).getTime(),"function"==typeof a&&a("wx_checkSession",n._checkSessionStartTime,n._checkSessionEndTime,P),F(t,n),e.emit("checkSessionFinished")}})):F(t,n)}function F(t,n){n.isLogin?"function"==typeof t&&t():T?x&&(new Date).getTime()>v?(T="",F(t,n)):"function"==typeof t&&t():k?e.wait("doLoginFinished",function(){F(t,n)}):(k=!0,n.count++,n._loginStartTime=(new Date).getTime(),console.log("wx.login"),wx.login({complete:function(){n.count--,n._loginEndTime=(new Date).getTime(),"function"==typeof a&&a("wx_login",n._loginStartTime,n._loginEndTime,P),"function"==typeof n.complete&&0==n.count&&n.complete()},success:function(c){var i;c.code?((i="function"==typeof o.data?o.data():o.data||{})[o.codeName]=c.code,n.count++,K({url:o.url,data:i,method:o.method,isLogin:!0,report:o.report||o.url,success:function(n){T=n,_=!0,x&&(v=(new Date).getTime()+x,wx.setStorage({key:S,data:v})),"function"==typeof t&&t(),wx.setStorage({key:u,data:T})},complete:function(){n.count--,"function"==typeof n.complete&&0==n.count&&n.complete(),k=!1,e.emit("doLoginFinished")},fail:o.fail||null})):(M(n,c),console.error(c),k=!1,e.emit("doLoginFinished"))},fail:function(t){M(n,t),console.error(t),k=!1,e.emit("doLoginFinished")}}))}function L(t){var n;return"function"==typeof t.beforeSend&&t.beforeSend(),void 0===t.reLoginLimit?t.reLoginLimit=0:t.reLoginLimit++,void 0===t.count&&(t.count=0),t.showLoading&&(i.show(t.showLoading),t.complete=(n=t.complete,function(){i.hide(),"function"==typeof n&&n.apply(this,arguments)})),t}function P(t){t.count++,t.data||(t.data={}),t.url,o.url;var n={};"function"==typeof g?n=g():"object"==typeof g&&(n=g),t.data=Object.assign({},n,t.data),t.method=t.method||"GET";var c=t.url.startsWith("http")?t.url:("function"==typeof d?d():d)+t.url;t.method,t.report&&(t._reportStartTime=(new Date).getTime()),wx.request({url:c,data:t.data,method:t.method,header:{Authorization:"Bearer "+T},dataType:t.dataType||"json",success:function(n){if(200==n.statusCode)if(t.report&&"function"==typeof a&&(t._reportEndTime=(new Date).getTime(),a(t.report,t._reportStartTime,t._reportEndTime,P)),t.isLogin){var c="";try{c=o.success(n.data)}catch(t){}c?t.success(c):M(t,n)}else if(f(n.data)&&t.reLoginLimit<y)T="",wx.removeStorage({key:u,complete:function(){F(function(){K(t)},t)}});else if(p(n.data)&&"function"==typeof t.success){var i=null;try{i=r(n.data)}catch(t){console.error("Function successData occur error: "+t)}t.noCacheFlash||t.success(i),(!0===t.cache||"function"==typeof t.cache&&t.cache(i))&&wx.setStorage({key:t.url,data:i})}else M(t,n);else M(t,n)},fail:function(n){M(t,n),console.error(n)},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete()}})}function M(t,n){if("function"==typeof t.fail)t.fail(n);else{var c="";if("function"==typeof m)try{c=m(n.data)}catch(t){}else"string"==typeof m&&(c=m);var i="";if("function"==typeof l)try{i=l(n.data)}catch(t){}else"string"==typeof l&&(i=l);wx.showModal({title:c,content:i||"网络或服务异常，请稍后重试",showCancel:!1})}"function"==typeof h&&h(t,n),console.error(n)}function K(t){t=L(t),w&&(w[t.url]||w[d+t.url])?function(t){var n={data:w[t.url]||w[d+t.url]};p(n.data)&&"function"==typeof t.success?t.success(r(n.data)):M(t,n);"function"==typeof t.complete&&t.complete()}(t):function(t,n){t.cache?wx.getStorage({key:t.url,success:function(c){"function"==typeof t.beforeSend&&t.beforeSend(),"function"==typeof t.cache&&t.cache(c.data)?"function"==typeof t.success&&t.success(c.data,{isCache:!0}):1==t.cache&&"function"==typeof t.success&&t.success(c.data,{isCache:!0}),"function"==typeof t.complete&&t.complete(),n(t)},fail:function(){t.noCacheFlash=!1,n(t)}}):n(t)}(t,function(t){O(function(){P(t)},t)})}function z(t){O(function(){!function(t){t.count++,t.formData||(t.formData={}),t.formData[u]=T;var n={};"function"==typeof g?n=g():"object"==typeof g&&(n=g),t.formData=Object.assign({},n,t.formData),t.dataType=t.dataType||"json";var c=t.url.startsWith("http")?t.url:("function"==typeof d?d():d)+t.url;t.report&&(t._reportStartTime=(new Date).getTime()),wx.uploadFile({url:c,header:Object.assign({Authorization:"Bearer "+T},t.header),filePath:t.filePath||"",name:t.name||"",formData:t.formData,success:function(n){if(200==n.statusCode&&"uploadFile:ok"==n.errMsg){if(t.report&&"function"==typeof a&&(t.endTime=(new Date).getTime(),a(t.report,t._reportStartTime,t._reportEndTime,P)),"json"==t.dataType)try{n.data=JSON.parse(n.data)}catch(c){return M(t,n),!1}f(n.data)&&t.reLoginLimit<y?(T="",wx.removeStorage({key:u,complete:function(){F(function(){z(t)},t)}})):p(n.data)&&"function"==typeof t.success?t.success(r(n.data)):M(t,n)}else M(t,n)},fail:function(n){M(t,n),console.error(n)},complete:function(){t.count--,"function"==typeof t.complete&&0==t.count&&t.complete()}})}(t)},t=L(t))}t.exports={init:function(t){u=t.sessionName||"session",f=t.loginTrigger||function(){return!1},o=t.codeToSession||{},p=t.successTrigger||function(){return!0},d=t.urlPerfix||"",r=t.successData||function(t){return t},m=t.errorTitle||"操作失败",l=t.errorContent||!1,y=t.reLoginLimit||3,h=t.errorCallback||null,_=t.doNotCheckSession||!1,a=t.reportCGI||!1,w=t.mockJson||!1,g=t.globalData||!1,x=t.sessionExpireTime||null,S=t.sessionExpireKey||"sessionExpireKey";try{T=wx.getStorageSync(u)||"",v=wx.getStorageSync(S)||1/0,(new Date).getTime()>v&&(T="")}catch(t){}},request:K,uploadFile:z,setSession:function(t){T=t,_=!0},login:function(t){O(t,{})},getSession:function(){return T},getConfig:function(){return{urlPerfix:d,sessionExpireTime:x,sessionExpireKey:S,sessionExpire:v}}}},function(t,n){t.exports={show:function(t){wx.showToast({title:"boolean"==typeof t?"加载中":t,icon:"loading",mask:!0,duration:6e4})},hide:function(){wx.hideToast()}}},function(t,n){var c={};function i(t){return c[t]||(c[t]={waitingList:[]}),c[t]}t.exports={wait:function(t,n){i(t).waitingList.push(n)},emit:function(t){var n=i(t);console.log("waitingList Length: "+n.waitingList.length);for(var c=n.waitingList.length,e=0;e<c;e++){var u=n.waitingList.shift();"function"==typeof u&&u()}}}}]);